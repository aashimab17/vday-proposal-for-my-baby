<script>
const questions = [
  {
    q: "What was my first thought when I realized I liked you?",
    options: [
      "ABBE YAAARRR",
      "Ye toh hona hi tha",
      "I would be one lucky bitch if he likes me back",
      "All of the above"
    ],
    correct: 3
  }
];

let index = 0;
let tries = 0;

/* ELEMENTS */
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
const scratchArea = document.getElementById("scratchArea");
const questionDiv = document.getElementById("question");
const optionsDiv = document.getElementById("options");
const feedback = document.getElementById("feedback");

/* CANVAS SETUP */
function setupCanvas() {
  canvas.width = scratchArea.offsetWidth;
  canvas.height = scratchArea.offsetHeight;

  ctx.globalCompositeOperation = "source-over";
  ctx.fillStyle = "#ff4d6d";
  ctx.fillRect(0, 0, canvas.width, canvas.height);
}

setupCanvas();

/* SCRATCH LOGIC */
let scratching = false;

function scratch(x, y) {
  ctx.globalCompositeOperation = "destination-out";
  ctx.beginPath();
  ctx.arc(x, y, 22, 0, Math.PI * 2);
  ctx.fill();
}

/* MOUSE */
canvas.addEventListener("mousedown", () => scratching = true);
canvas.addEventListener("mouseup", () => scratching = false);
canvas.addEventListener("mouseleave", () => scratching = false);
canvas.addEventListener("mousemove", e => {
  if (!scratching) return;
  scratch(e.offsetX, e.offsetY);
});

/* TOUCH */
canvas.addEventListener("touchstart", () => scratching = true);
canvas.addEventListener("touchend", () => scratching = false);
canvas.addEventListener("touchmove", e => {
  if (!scratching) return;
  const rect = canvas.getBoundingClientRect();
  const touch = e.touches[0];
  scratch(touch.clientX - rect.left, touch.clientY - rect.top);
  e.preventDefault();
});

/* REVEAL QUESTION AFTER SCRATCH */
setTimeout(revealQuestion, 1500);

function revealQuestion() {
  canvas.style.display = "none";
  document.getElementById("scratchText").style.display = "none";
  questionDiv.style.display = "block";
  loadQuestion();
}

/* LOAD QUESTION */
function loadQuestion() {
  const q = questions[index];
  questionDiv.innerHTML = `<h2>${q.q}</h2>`;
  optionsDiv.innerHTML = "";
  feedback.textContent = "";

  q.options.forEach((opt, i) => {
    const div = document.createElement("div");
    div.className = "option";
    div.textContent = opt;
    div.onclick = () => selectAnswer(div, i);
    optionsDiv.appendChild(div);
  });
}

/* ANSWER HANDLING */
function selectAnswer(el, i) {
  const correct = questions[index].correct;

  if (i === correct) {
    el.classList.add("correct");
    feedback.textContent = "Correct üòåüíó";
  } else {
    tries++;
    el.classList.add("wrong");

    if (tries === 1) {
      feedback.textContent = "Hmm‚Ä¶ try again üòê";
    } else {
      feedback.textContent =
        `Correct answer: ${questions[index].options[correct]} üòå`;
    }
  }
}
</script>
