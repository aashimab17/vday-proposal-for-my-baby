<script>
/* ===== INSTRUCTIONS (JS ONLY) ===== */
const instructions = document.createElement("div");
instructions.id = "instructions";
instructions.className = "modal";
instructions.innerHTML = `
  <div class="modal-box">
    <h2>Claw Machine Rules ğŸ®</h2>
    <p>
      Move the basket left and right.<br><br>
      Click anywhere or press <b>SPACE</b> to drop the claw ğŸ§ºâ¬‡ï¸<br><br>
      Catch 3 surprises to unlock whatâ€™s next ğŸ’
    </p>
    <button onclick="startGame()">Letâ€™s play ğŸ˜</button>
  </div>
`;
document.body.appendChild(instructions);

/* ===== GAME SETUP ===== */
const game = document.getElementById("game");
const claw = document.getElementById("claw");

let clawX = window.innerWidth / 2;
let canDrop = true;
let caughtCount = 0;
const maxGifts = 3;

const gifts = {
  "ğŸ³": "One homemade meal by baby ğŸ‘©â€ğŸ³ğŸ’•",
  "â˜•": "Morning coffee in bed privileges for life â˜•ğŸ˜Œ",
  "â¤ï¸": "I will flash you anytime you want. No questions asked ğŸ˜ŒğŸ”¥",
  "ğŸ‘¶": "I will keep your inner child alive forever ğŸ¤ªğŸ§¸",
  "ğŸ˜˜": "If you kiss me during an argument, it ends there ğŸ˜¤ğŸ’‹"
};

const emojis = Object.keys(gifts);

/* MOVE CLAW LEFT / RIGHT */
document.addEventListener("mousemove", e => {
  clawX = e.clientX;
  claw.style.left = clawX + "px";
});

/* DROP CLAW */
document.addEventListener("click", dropClaw);
document.addEventListener("keydown", e => {
  if (e.code === "Space") dropClaw();
});

/* START GAME */
function startGame() {
  instructions.style.display = "none";
  spawnEmoji();
}

/* SPAWN ONE EMOJI */
function spawnEmoji() {
  if (caughtCount >= maxGifts) return;

  const emoji = document.createElement("div");
  emoji.className = "emoji";
  emoji.textContent = emojis[Math.floor(Math.random() * emojis.length)];
  emoji.style.left = Math.random() * 80 + "vw";
  emoji.style.animationDuration = "6s";

  game.appendChild(emoji);

  emoji.addEventListener("animationend", () => {
    emoji.remove();
    if (canDrop) spawnEmoji();
  });
}

/* DROP LOGIC */
function dropClaw() {
  if (!canDrop) return;
  canDrop = false;

  const clawRect = claw.getBoundingClientRect();
  const emojisOnScreen = document.querySelectorAll(".emoji");

  emojisOnScreen.forEach(emoji => {
    const eRect = emoji.getBoundingClientRect();
    if (
      eRect.left < clawRect.right &&
      eRect.right > clawRect.left &&
      eRect.top < clawRect.bottom
    ) {
      caughtCount++;
      showGift(emoji.textContent);
      emoji.remove();
    }
  });

  setTimeout(() => {
    canDrop = true;
    spawnEmoji();
  }, 800);
}

/* SHOW GIFT */
function showGift(symbol) {
  const popup = document.createElement("div");
  popup.className = "gift-popup";
  popup.innerHTML = `
    <div class="gift-box">
      <h3>${symbol} Gift unlocked ğŸ’</h3>
      <p>${gifts[symbol]}</p>
      ${
        caughtCount >= maxGifts
          ? `<button onclick="goNext()">That was cute, what next? ğŸ˜Œ</button>`
          : `<button onclick="this.closest('.gift-popup').remove()">Keep playing ğŸ®</button>`
      }
    </div>
  `;
  document.body.appendChild(popup);
}

/* NEXT PAGE */
function goNext() {
  window.location.href = "scratch.html";
}
</script>
